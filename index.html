<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>センサ管理システム</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- スタイルは省略せず元のCSSを使用 --- */
        /* ご希望があれば CSS 部分も調整して再送できます */
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>センサ管理システム</h1>
            <p id="headerSubtitle">研究室センサの利用状況を管理</p>
        </header>

        <div class="content">
            <!-- ステップ1: センサ情報入力 -->
            <div class="step active" id="step1">
                <h2 id="step1Title">センサ利用登録</h2>
                <div class="form-group">
                    <label for="sensorType">センサの種類</label>
                    <div class="custom-select">
                        <select id="sensorType" onchange="isReturning ? updateReturnableSensorIds() : updateSensorIds()">
                            <option value="">選択してください</option>
                            <option value="1">Panasonic 温度センサ</option>
                            <option value="2">OMRON 圧力センサ</option>
                            <option value="3">東京計器 流量センサ</option>
                            <option value="4">Keyence 光センサ</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="sensorId">センサID</label>
                    <div class="custom-select">
                        <select id="sensorId" disabled>
                            <option value="">センサの種類を先に選択してください</option>
                        </select>
                    </div>
                </div>

                <button id="checkButton" onclick="checkStatus()" class="ripple-effect">
                    <i class="fas fa-check-circle"></i> 確認
                </button>
                <button id="returnButton" class="secondary-button ripple-effect" onclick="showReturnMode()">
                    <i class="fas fa-undo-alt"></i> センサを返却する
                </button>
            </div>

            <!-- ステップ2 -->
            <div class="step" id="step2">
                <div id="statusAvailable" style="display: none;">
                    <div class="status-box status-available">
                        <div class="status-info">
                            <p>ステータス</p>
                            <p class="status-text">利用可能</p>
                        </div>
                        <div class="status-icon available-icon">
                            <i class="fas fa-check"></i>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="userName">お名前</label>
                        <input type="text" id="userName" placeholder="例: 山田太郎">
                    </div>

                    <div class="form-group">
                        <label for="purpose">用途
                            <span class="tooltip">
                                <i class="fas fa-info-circle tooltip-icon"></i>
                                <span class="tooltip-text">実験の目的や使用する理由を入力してください</span>
                            </span>
                        </label>
                        <input type="text" id="purpose" placeholder="例: 実験、研究、デモンストレーションなど">
                    </div>

                    <button onclick="registerUsage()" class="ripple-effect">
                        <i class="fas fa-save"></i> 利用登録する
                    </button>
                    <button class="secondary-button ripple-effect" onclick="resetForm()">
                        <i class="fas fa-arrow-left"></i> 戻る
                    </button>
                </div>

                <div id="statusInUse" style="display: none;">
                    <div class="status-box status-inuse">
                        <div class="status-info">
                            <p>ステータス</p>
                            <p class="status-text">使用中</p>
                        </div>
                        <div class="status-icon inuse-icon">
                            <i class="fas fa-exclamation"></i>
                        </div>
                    </div>

                    <div class="alert">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>このセンサは現在使用中です。別のセンサを選択してください。</span>
                    </div>

                    <button onclick="resetForm()" class="ripple-effect">
                        <i class="fas fa-arrow-left"></i> 戻る
                    </button>
                </div>

                <div id="statusReturning" style="display: none;">
                    <div class="status-box status-returning">
                        <div class="status-info">
                            <p>ステータス</p>
                            <p class="status-text">返却処理</p>
                        </div>
                        <div class="status-icon returning-icon">
                            <i class="fas fa-exchange-alt"></i>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="returnerName">お名前</label>
                        <input type="text" id="returnerName" placeholder="例: 山田太郎">
                    </div>

                    <button onclick="returnSensor()" class="ripple-effect">
                        <i class="fas fa-check-double"></i> 返却する
                    </button>
                    <button class="secondary-button ripple-effect" onclick="resetForm()">
                        <i class="fas fa-arrow-left"></i> 戻る
                    </button>
                </div>
            </div>

            <!-- ステップ3 -->
            <div class="step" id="step3">
                <div id="registrationComplete" style="display: none;">
                    <div class="completion-message">
                        <div class="completion-icon">
                            <i class="fas fa-check"></i>
                        </div>
                        <h2>利用登録完了</h2>
                        <p>センサの利用が登録されました</p>
                    </div>

                    <div class="info-panel">
                        <h3>登録情報</h3>
                        <ul class="info-list">
                            <li><span>センサタイプ</span><span id="summaryType"></span></li>
                            <li><span>センサID</span><span id="summaryId"></span></li>
                            <li><span>利用者</span><span id="summaryUser"></span></li>
                            <li><span>用途</span><span id="summaryPurpose"></span></li>
                            <li><span>ステータス</span><span><span class="badge badge-inuse">使用中</span></span></li>
                        </ul>
                    </div>

                    <button onclick="resetForm()" class="ripple-effect">
                        <i class="fas fa-home"></i> トップに戻る
                    </button>
                </div>

                <div id="returnComplete" style="display: none;">
                    <div class="completion-message">
                        <div class="completion-icon">
                            <i class="fas fa-check"></i>
                        </div>
                        <h2>返却完了</h2>
                        <p>センサが正常に返却されました</p>
                    </div>

                    <div class="info-panel">
                        <h3>返却情報</h3>
                        <ul class="info-list">
                            <li><span>センサタイプ</span><span id="returnSummaryType"></span></li>
                            <li><span>センサID</span><span id="returnSummaryId"></span></li>
                            <li><span>返却者</span><span id="returnSummaryUser"></span></li>
                            <li><span>ステータス</span><span><span class="badge badge-available">利用可能</span></span></li>
                        </ul>
                    </div>

                    <button onclick="resetForm()" class="ripple-effect">
                        <i class="fas fa-home"></i> トップに戻る
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Help Button -->
    <!-- toggleHelp 関数が未定義なので、必要に応じて定義してください -->
    <div class="fab-button" id="helpButton" onclick="/* toggleHelp() */">
        <i class="fas fa-question"></i>
    </div>

    <!-- スクリプト：元のJavaScriptをそのまま活用 -->
    <script>
        /* --- あなたの元コードにあるJS関数群をここに入れてください --- */
              // センサタイプのデータ
        const sensorTypes = [
            { id: 1, name: 'Panasonic 温度センサ' },
            { id: 2, name: 'OMRON 圧力センサ' },
            { id: 3, name: '東京計器 流量センサ' },
            { id: 4, name: 'Keyence 光センサ' }
        ];
        
        // センサIDのデータ（センサタイプIDに対応）
        const sensorIds = {
            '1': [
                { id: 'TP001', status: 'available' },
                { id: 'TP002', status: 'in-use' },
                { id: 'TP003', status: 'available' },
                { id: 'TP004', status: 'in-use' }
            ],
            '2': [
                { id: 'PR001', status: 'available' },
                { id: 'PR002', status: 'available' },
                { id: 'PR003', status: 'in-use' }
            ],
            '3': [
                { id: 'FL001', status: 'in-use' },
                { id: 'FL002', status: 'available' },
                { id: 'FL003', status: 'available' }
            ],
            '4': [
                { id: 'LS001', status: 'available' },
                { id: 'LS002', status: 'in-use' },
                { id: 'LS003', status: 'available' },
                { id: 'LS004', status: 'available' }
            ]
        };
        
        // isReturning フラグ
        let isReturning = false;
        
        // センサIDのプルダウンを更新
        function updateSensorIds() {
            const sensorTypeSelect = document.getElementById('sensorType');
            const sensorIdSelect = document.getElementById('sensorId');
            const selectedType = sensorTypeSelect.value;
            
            // まずセレクトボックスをリセット
            sensorIdSelect.innerHTML = '';
            
            if (!selectedType) {
                // 何も選択されていない場合
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = 'センサの種類を先に選択してください';
                sensorIdSelect.appendChild(defaultOption);
                sensorIdSelect.disabled = true;
                return;
            }
            
            // デフォルトオプション
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = '選択してください';
            sensorIdSelect.appendChild(defaultOption);
            
            // 選択されたセンサタイプに対応するIDを追加（利用可能なもののみ）
            const ids = sensorIds[selectedType] || [];
            const availableIds = ids.filter(idInfo => idInfo.status === 'available');
            
            if (availableIds.length === 0) {
                const noOption = document.createElement('option');
                noOption.value = '';
                noOption.textContent = '利用可能なセンサはありません';
                noOption.disabled = true;
                sensorIdSelect.appendChild(noOption);
            } else {
                availableIds.forEach(idInfo => {
                    const option = document.createElement('option');
                    option.value = idInfo.id;
                    option.textContent = idInfo.id;
                    option.dataset.status = idInfo.status;
                    sensorIdSelect.appendChild(option);
                });
            }
            
            // セレクトボックスを有効化
            sensorIdSelect.disabled = false;
        }
        
        // ステップ表示関数
        function showStep(stepNumber) {
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active');
            });
            document.getElementById('step' + stepNumber).classList.add('active');
        }
        
        // ステータス確認（兼 返却モード確認）
        function checkStatus() {
            const sensorTypeSelect = document.getElementById('sensorType');
            const sensorIdSelect = document.getElementById('sensorId');
            const sensorType = sensorTypeSelect.value;
            const sensorId = sensorIdSelect.value;
            
            if (!sensorType || !sensorId) {
                alert('センサの種類とIDを選択してください');
                return;
            }
            
            showStep(2);
            
            if (isReturning) {
                // 返却モードの場合、返却画面を表示
                document.getElementById('statusAvailable').style.display = 'none';
                document.getElementById('statusInUse').style.display = 'none';
                document.getElementById('statusReturning').style.display = 'block';
            } else {
                // 利用登録モードの場合、常に利用可能状態を表示（利用可能なセンサのみ表示しているため）
                document.getElementById('statusAvailable').style.display = 'block';
                document.getElementById('statusInUse').style.display = 'none';
                document.getElementById('statusReturning').style.display = 'none';
            }
        }
        
        // 返却モードに切替える別の関数を作成
        function showReturnMode() {
            isReturning = true;
            
            // センサタイプのセレクトボックスをクリア
            const sensorTypeSelect = document.getElementById('sensorType');
            sensorTypeSelect.value = '';
            
            // センサIDのセレクトボックスをクリア
            updateReturnableSensorIds();
            
            // 返却モードビューに切り替え
            document.getElementById('step1Title').textContent = 'センサ返却';
            document.getElementById('checkButton').textContent = '返却確認';
            document.getElementById('returnButton').style.display = 'none';
        }
        
        // 返却可能なセンサIDのプルダウンを更新
        function updateReturnableSensorIds() {
            const sensorTypeSelect = document.getElementById('sensorType');
            const sensorIdSelect = document.getElementById('sensorId');
            const selectedType = sensorTypeSelect.value;
            
            // まずセレクトボックスをリセット
            sensorIdSelect.innerHTML = '';
            
            if (!selectedType) {
                // 何も選択されていない場合
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = 'センサの種類を先に選択してください';
                sensorIdSelect.appendChild(defaultOption);
                sensorIdSelect.disabled = true;
                return;
            }
            
            // デフォルトオプション
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = '選択してください';
            sensorIdSelect.appendChild(defaultOption);
            
            // 選択されたセンサタイプに対応するIDを追加（使用中のもののみ）
            const ids = sensorIds[selectedType] || [];
            const inUseIds = ids.filter(idInfo => idInfo.status === 'in-use');
            
            if (inUseIds.length === 0) {
                const noOption = document.createElement('option');
                noOption.value = '';
                noOption.textContent = '返却可能なセンサはありません';
                noOption.disabled = true;
                sensorIdSelect.appendChild(noOption);
            } else {
                inUseIds.forEach(idInfo => {
                    const option = document.createElement('option');
                    option.value = idInfo.id;
                    option.textContent = idInfo.id;
                    option.dataset.status = idInfo.status;
                    sensorIdSelect.appendChild(option);
                });
            }
            
            // セレクトボックスを有効化
            sensorIdSelect.disabled = false;
        }
        
        // 利用登録処理
        function registerUsage() {
            const userName = document.getElementById('userName').value;
            const purpose = document.getElementById('purpose').value;
            
            if (!userName || !purpose) {
                alert('お名前と用途を入力してください');
                return;
            }
            
            // モックの非同期操作（本番では実際のAPIを呼び出す）
            setTimeout(() => {
                showStep(3);
                document.getElementById('registrationComplete').style.display = 'block';
                document.getElementById('returnComplete').style.display = 'none';
                
                // 登録情報のサマリー
                const sensorTypeId = document.getElementById('sensorType').value;
                const sensorTypeName = sensorTypes.find(t => t.id == sensorTypeId)?.name || '';
                
                document.getElementById('summaryType').textContent = sensorTypeName;
                document.getElementById('summaryId').textContent = document.getElementById('sensorId').value;
                document.getElementById('summaryUser').textContent = userName;
                document.getElementById('summaryPurpose').textContent = purpose;
            }, 500);
        }
        
        // センサ返却処理
        function returnSensor() {
            const returnerName = document.getElementById('returnerName').value;
            
            if (!returnerName) {
                alert('お名前を入力してください');
                return;
            }
            
            // モックの非同期操作（本番では実際のAPIを呼び出す）
            setTimeout(() => {
                showStep(3);
                document.getElementById('registrationComplete').style.display = 'none';
                document.getElementById('returnComplete').style.display = 'block';
                
                // 返却情報のサマリー
                const sensorTypeId = document.getElementById('sensorType').value;
                const sensorTypeName = sensorTypes.find(t => t.id == sensorTypeId)?.name || '';
                
                document.getElementById('returnSummaryType').textContent = sensorTypeName;
                document.getElementById('returnSummaryId').textContent = document.getElementById('sensorId').value;
                document.getElementById('returnSummaryUser').textContent = returnerName;
            }, 500);
        }
        
        // フォームのリセット
        function resetForm() {
            document.getElementById('sensorType').value = '';
            document.getElementById('sensorId').innerHTML = '<option value="">センサの種類を先に選択してください</option>';
            document.getElementById('sensorId').disabled = true;
            document.getElementById('userName').value = '';
            document.getElementById('purpose').value = '';
            document.getElementById('returnerName').value = '';
            
            isReturning = false;
            document.getElementById('step1Title').textContent = 'センサ利用登録';
            document.getElementById('checkButton').textContent = '確認';
            document.getElementById('returnButton').style.display = 'block';
            
            showStep(1);
        }
    </script>
</body>
</html>

