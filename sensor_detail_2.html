<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚»ãƒ³ã‚µç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - LiDARåˆ©ç”¨ç™»éŒ²</title>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 500px;
            margin: 20px auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 20px;
        }
        
        .sensor-icon {
            font-size: 48px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .step {
            display: none;
        }
        
        .step.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px;
        }
        
        button {
            display: block;
            width: 100%;
            padding: 12px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        
        .status-box {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .status-available {
            background-color: #e8f8f5;
            border: 1px solid #82e0aa;
        }
        
        .status-inuse {
            background-color: #fdedec;
            border: 1px solid #f5b7b1;
        }
        
        .status-returning {
            background-color: #eaf2f8;
            border: 1px solid #aed6f1;
        }
        
        .status-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .status-text {
            font-weight: bold;
        }
        
        .available-icon {
            background-color: #82e0aa;
            color: white;
        }
        
        .inuse-icon {
            background-color: #f5b7b1;
            color: white;
        }
        
        .returning-icon {
            background-color: #aed6f1;
            color: white;
        }
        
        .secondary-button {
            background-color: #95a5a6;
            margin-top: 10px;
        }
        
        .secondary-button:hover {
            background-color: #7f8c8d;
        }
        
        .completion-message {
            text-align: center;
            padding: 20px 0;
        }
        
        .completion-icon {
            font-size: 48px;
            color: #27ae60;
            margin-bottom: 10px;
        }
        
        .info-panel {
            background-color: #f8f9fa;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .info-list {
            list-style-type: none;
            padding: 0;
        }
        
        .info-list li {
            padding: 5px 0;
            border-bottom: 1px solid #ecf0f1;
        }
        
        .info-list li:last-child {
            border-bottom: none;
        }
        
        .alert {
            background-color: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        
        .choice-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        
        .choice-button {
            flex: 1;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .choice-button.borrow {
            background-color: #e8f8f5;
            border: 2px solid #82e0aa;
            color: #27ae60;
        }
        
        .choice-button.borrow:hover {
            background-color: #d1f2e4;
            transform: translateY(-3px);
        }
        
        .choice-button.return {
            background-color: #eaf2f8;
            border: 2px solid #aed6f1;
            color: #3498db;
        }
        
        .choice-button.return:hover {
            background-color: #d6e9f9;
            transform: translateY(-3px);
        }
        
        .choice-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .no-sensors-message {
            text-align: center;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            color: #7f8c8d;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>LiDARã‚»ãƒ³ã‚µç®¡ç†</h1>
        <div class="sensor-icon">ğŸ“¡</div>
        
        <!-- ã‚¹ãƒ†ãƒƒãƒ—0: æ“ä½œé¸æŠç”»é¢ -->
        <div class="step active" id="step0">
            <h2>æ“ä½œã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
            
            <div class="choice-buttons">
                <div class="choice-button borrow" onclick="showBorrowMode()">
                    <div class="choice-icon">ğŸ“¥</div>
                    <div class="choice-title">åˆ©ç”¨ç™»éŒ²</div>
                    <div class="choice-desc">LiDARã‚’å€Ÿã‚Šã‚‹</div>
                </div>
                
                <div class="choice-button return" onclick="showNameInputForReturn()">
                    <div class="choice-icon">ğŸ“¤</div>
                    <div class="choice-title">è¿”å´ç™»éŒ²</div>
                    <div class="choice-desc">LiDARã‚’è¿”ã™</div>
                </div>
            </div>
        </div>
        
        <!-- ã‚¹ãƒ†ãƒƒãƒ—0.5: è¿”å´ç”¨åå‰å…¥åŠ›ç”»é¢ -->
        <div class="step" id="step0_5">
            <h2>è¿”å´ç™»éŒ²</h2>
            <p>ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ä½¿ç”¨ä¸­ã®LiDARã‚’æ¤œç´¢ã—ã¾ã™ã€‚</p>
            
            <div class="form-group">
                <label for="returnSearchName">ãŠåå‰</label>
                <input type="text" id="returnSearchName" placeholder="ä¾‹: å±±ç”°å¤ªéƒ">
            </div>
            
            <button onclick="searchUserSensors()">æ¤œç´¢</button>
            <button class="secondary-button" onclick="resetForm()">æˆ»ã‚‹</button>
        </div>
        
        <!-- ã‚¹ãƒ†ãƒƒãƒ—0.6: è¿”å´ã™ã‚‹ã‚»ãƒ³ã‚µé¸æŠç”»é¢ -->
        <div class="step" id="step0_6">
            <h2>è¿”å´ã™ã‚‹LiDARã‚’é¸æŠ</h2>
            <p><span id="returnerNameDisplay"></span>ã•ã‚“ãŒä½¿ç”¨ä¸­ã®LiDARã‚»ãƒ³ã‚µ</p>
            
            <div id="userSensorsContainer">
                <!-- ã“ã“ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå€Ÿã‚Šã¦ã„ã‚‹ã‚»ãƒ³ã‚µã®ãƒªã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ -->
            </div>
            
            <div class="form-group" id="userSensorSelectContainer" style="display: none;">
                <label for="userSensorSelect">è¿”å´ã™ã‚‹LiDAR</label>
                <select id="userSensorSelect">
                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                </select>
            </div>
            
            <button id="confirmReturnButton" onclick="confirmReturn()" style="display: none;">è¿”å´æ‰‹ç¶šãã¸</button>
            <button class="secondary-button" onclick="resetForm()">æˆ»ã‚‹</button>
        </div>
        
        <!-- ã‚¹ãƒ†ãƒƒãƒ—1: ã‚»ãƒ³ã‚µæƒ…å ±å…¥åŠ› -->
        <div class="step" id="step1">
            <h2 id="step1Title">LiDARåˆ©ç”¨ç™»éŒ²</h2>
            <div class="form-group">
                <label for="sensorType">ãƒ¡ãƒ¼ã‚«ãƒ¼</label>
                <select id="sensorType" onchange="updateSensorIds()">
                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    <option value="1">Velodyne</option>
                    <option value="2">Ouster</option>
                    <option value="3">SICK</option>
                    <option value="4">Livox</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="sensorId">LiDAR ID</label>
                <select id="sensorId" disabled>
                    <option value="">ãƒ¡ãƒ¼ã‚«ãƒ¼ã‚’å…ˆã«é¸æŠã—ã¦ãã ã•ã„</option>
                </select>
            </div>
            
            <button id="checkButton" onclick="checkStatus()">ç¢ºèª</button>
            <button class="secondary-button" onclick="resetForm()">æˆ»ã‚‹</button>
        </div>
        
        <!-- ã‚¹ãƒ†ãƒƒãƒ—2: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèªã¨åˆ©ç”¨æƒ…å ±å…¥åŠ› -->
        <div class="step" id="step2">
            <div id="statusAvailable" style="display: none;">
                <div class="status-box status-available">
                    <div>
                        <p>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</p>
                        <p class="status-text">åˆ©ç”¨å¯èƒ½</p>
                    </div>
                    <div class="status-icon available-icon">âœ“</div>
                </div>
                
                <div class="form-group">
                    <label for="userName">ãŠåå‰</label>
                    <input type="text" id="userName" placeholder="ä¾‹: å±±ç”°å¤ªéƒ">
                </div>
                
                <div class="form-group">
                    <label for="purpose">ç”¨é€”</label>
                    <input type="text" id="purpose" placeholder="ä¾‹: å®Ÿé¨“ã€ç ”ç©¶ã€ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãªã©">
                </div>
                
                <button onclick="registerUsage()">åˆ©ç”¨ç™»éŒ²ã™ã‚‹</button>
                <button class="secondary-button" onclick="resetForm()">æˆ»ã‚‹</button>
            </div>
            
            <div id="statusReturning" style="display: none;">
                <div class="status-box status-returning">
                    <div>
                        <p>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</p>
                        <p class="status-text">è¿”å´å‡¦ç†</p>
                    </div>
                    <div class="status-icon returning-icon">â†”</div>
                </div>
                
                <div class="info-panel">
                    <h3>è¿”å´æƒ…å ±</h3>
                    <ul class="info-list">
                        <li>ãƒ¡ãƒ¼ã‚«ãƒ¼: <span id="returnInfoMaker"></span></li>
                        <li>LiDAR ID: <span id="returnInfoId"></span></li>
                        <li>ãƒ¢ãƒ‡ãƒ«: <span id="returnInfoModel"></span></li>
                        <li>ä½¿ç”¨è€…: <span id="returnInfoUser"></span></li>
                    </ul>
                </div>
                
                <div class="form-group">
                    <label for="returnComment">è¿”å´ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆä»»æ„ï¼‰</label>
                    <input type="text" id="returnComment" placeholder="æ•…éšœã‚„ä¸å…·åˆãŒã‚ã‚Œã°è¨˜å…¥ã—ã¦ãã ã•ã„">
                </div>
                
                <button onclick="returnSensor()">è¿”å´ã™ã‚‹</button>
                <button class="secondary-button" onclick="resetForm()">æˆ»ã‚‹</button>
            </div>
        </div>
        
        <!-- ã‚¹ãƒ†ãƒƒãƒ—3: å®Œäº†ç”»é¢ -->
        <div class="step" id="step3">
            <div id="registrationComplete" style="display: none;">
                <div class="completion-message">
                    <div class="completion-icon">âœ“</div>
                    <h2>åˆ©ç”¨ç™»éŒ²å®Œäº†</h2>
                    <p>LiDARã®åˆ©ç”¨ãŒç™»éŒ²ã•ã‚Œã¾ã—ãŸã€‚</p>
                </div>
                
                <div class="info-panel">
                    <h3>ç™»éŒ²æƒ…å ±</h3>
                    <ul class="info-list">
                        <li>ãƒ¡ãƒ¼ã‚«ãƒ¼: <span id="summaryType"></span></li>
                        <li>LiDAR ID: <span id="summaryId"></span></li>
                        <li>ãƒ¢ãƒ‡ãƒ«: <span id="summaryModel"></span></li>
                        <li>åˆ©ç”¨è€…: <span id="summaryUser"></span></li>
                        <li>ç”¨é€”: <span id="summaryPurpose"></span></li>
                        <li>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: <span>ä½¿ç”¨ä¸­</span></li>
                    </ul>
                </div>
                
                <button onclick="resetForm()">ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹</button>
            </div>
            
            <div id="returnComplete" style="display: none;">
                <div class="completion-message">
                    <div class="completion-icon">âœ“</div>
                    <h2>è¿”å´å®Œäº†</h2>
                    <p>LiDARãŒæ­£å¸¸ã«è¿”å´ã•ã‚Œã¾ã—ãŸã€‚</p>
                </div>
                
                <div class="info-panel">
                    <h3>è¿”å´æƒ…å ±</h3>
                    <ul class="info-list">
                        <li>ãƒ¡ãƒ¼ã‚«ãƒ¼: <span id="returnSummaryType"></span></li>
                        <li>LiDAR ID: <span id="returnSummaryId"></span></li>
                        <li>ãƒ¢ãƒ‡ãƒ«: <span id="returnSummaryModel"></span></li>
                        <li>è¿”å´è€…: <span id="returnSummaryUser"></span></li>
                        <li>ã‚³ãƒ¡ãƒ³ãƒˆ: <span id="returnSummaryComment"></span></li>
                        <li>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: <span>åˆ©ç”¨å¯èƒ½</span></li>
                    </ul>
                </div>
                
                <button onclick="resetForm()">ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹</button>
            </div>
        </div>
    </div>

    <script>
        // ã‚»ãƒ³ã‚µã‚¿ã‚¤ãƒ—ï¼ˆãƒ¡ãƒ¼ã‚«ãƒ¼ï¼‰ã®ãƒ‡ãƒ¼ã‚¿
        const sensorTypes = [
            { id: 1, name: 'Velodyne' },
            { id: 2, name: 'Ouster' },
            { id: 3, name: 'SICK' },
            { id: 4, name: 'Livox' }
        ];
        
        // ã‚»ãƒ³ã‚µIDï¼ˆLiDAR IDï¼‰ã®ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ¡ãƒ¼ã‚«ãƒ¼IDã«å¯¾å¿œï¼‰- ä½¿ç”¨è€…æƒ…å ±ã‚’è¿½åŠ 
        const sensorIds = {
            '1': [
                { id: 'VLP-16-001', status: 'available', model: 'VLP-16 Puck', user: null, purpose: null },
                { id: 'VLP-32-001', status: 'in-use', model: 'VLP-32 Ultra Puck', user: 'å±±ç”°å¤ªéƒ', purpose: 'è‡ªå‹•é‹è»¢å®Ÿé¨“' },
                { id: 'HDL-64-001', status: 'available', model: 'HDL-64E', user: null, purpose: null }
            ],
            '2': [
                { id: 'OS1-64-001', status: 'available', model: 'OS1-64', user: null, purpose: null },
                { id: 'OS0-128-001', status: 'available', model: 'OS0-128', user: null, purpose: null },
                { id: 'OS2-128-001', status: 'in-use', model: 'OS2-128', user: 'ä½è—¤èŠ±å­', purpose: 'ç’°å¢ƒãƒãƒƒãƒ”ãƒ³ã‚°' }
            ],
            '3': [
                { id: 'LMS-111-001', status: 'in-use', model: 'LMS-111', user: 'å±±ç”°å¤ªéƒ', purpose: 'éšœå®³ç‰©æ¤œçŸ¥ã‚·ã‚¹ãƒ†ãƒ é–‹ç™º' },
                { id: 'TiM-781-001', status: 'available', model: 'TiM-781', user: null, purpose: null }
            ],
            '4': [
                { id: 'MID-70-001', status: 'available', model: 'Mid-70', user: null, purpose: null },
                { id: 'HOR-32-001', status: 'in-use', model: 'Horizon', user: 'éˆ´æœ¨ä¸€éƒ', purpose: 'ãƒ­ãƒœãƒƒãƒˆåˆ¶å¾¡' },
                { id: 'AVA-001', status: 'available', model: 'Avia', user: null, purpose: null }
            ]
        };
        
        // åˆ©ç”¨ãƒ¢ãƒ¼ãƒ‰ã‹è¿”å´ãƒ¢ãƒ¼ãƒ‰ã‹ã®ãƒ•ãƒ©ã‚°
        let isReturning = false;
        
        // é¸æŠã•ã‚ŒãŸè¿”å´ã‚»ãƒ³ã‚µã®æƒ…å ±
        let selectedReturnSensor = null;
        
        // å€Ÿã‚Šã‚‹ãƒ¢ãƒ¼ãƒ‰ã‚’è¡¨ç¤º
        function showBorrowMode() {
            isReturning = false;
            showStep(1);
        }
        
        // è¿”å´ç”¨ã®åå‰å…¥åŠ›ç”»é¢ã‚’è¡¨ç¤º
        function showNameInputForReturn() {
            showStep('0_5');
        }
        
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå€Ÿã‚Šã¦ã„ã‚‹ã‚»ãƒ³ã‚µã‚’æ¤œç´¢
        function searchUserSensors() {
            const userName = document.getElementById('returnSearchName').value;
            
            if (!userName) {
                alert('ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’ãƒšãƒ¼ã‚¸ã«è¡¨ç¤º
            document.getElementById('returnerNameDisplay').textContent = userName;
            
            // ä½¿ç”¨ä¸­ã®ã‚»ãƒ³ã‚µã‚’æ¤œç´¢
            const userSensors = [];
            
            // ã™ã¹ã¦ã®ãƒ¡ãƒ¼ã‚«ãƒ¼ã®ã‚»ãƒ³ã‚µã‚’ãƒã‚§ãƒƒã‚¯
            for (const makerKey in sensorIds) {
                const makerId = makerKey;
                const makerName = sensorTypes.find(type => type.id == makerId).name;
                
                sensorIds[makerKey].forEach(sensor => {
                    if (sensor.status === 'in-use' && sensor.user === userName) {
                        userSensors.push({
                            id: sensor.id,
                            model: sensor.model,
                            makerid: makerId,
                            maker: makerName,
                            purpose: sensor.purpose
                        });
                    }
                });
            }
            
            const container = document.getElementById('userSensorsContainer');
            const selectContainer = document.getElementById('userSensorSelectContainer');
            const select = document.getElementById('userSensorSelect');
            const confirmButton = document.getElementById('confirmReturnButton');
            
            // ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆ
            select.innerHTML = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>';
            
            if (userSensors.length === 0) {
                // ä½¿ç”¨ä¸­ã®ã‚»ãƒ³ã‚µãŒãªã„å ´åˆ
                container.innerHTML = `
                    <div class="no-sensors-message">
                        <p>è©²å½“ã™ã‚‹LiDARã‚»ãƒ³ã‚µãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</p>
                        <p>ãŠåå‰ãŒæ­£ã—ã„ã‹ã”ç¢ºèªãã ã•ã„</p>
                    </div>
                `;
                selectContainer.style.display = 'none';
                confirmButton.style.display = 'none';
            } else {
                // ä½¿ç”¨ä¸­ã®ã‚»ãƒ³ã‚µãŒã‚ã‚‹å ´åˆ
                let html = '<div class="info-panel"><ul class="info-list">';
                
                userSensors.forEach(sensor => {
                    html += `
                        <li>
                            <strong>${sensor.maker} ${sensor.model}</strong><br>
                            ID: ${sensor.id}<br>
                            ç”¨é€”: ${sensor.purpose}
                        </li>
                    `;
                    
                    // ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
                    const option = document.createElement('option');
                    option.value = JSON.stringify({
                        id: sensor.id,
                        makerid: sensor.makerid,
                        maker: sensor.maker,
                        model: sensor.model
                    });
                    option.textContent = `${sensor.maker} ${sensor.model} (${sensor.id})`;
                    select.appendChild(option);
                });
                
                html += '</ul></div>';
                container.innerHTML = html;
                
                selectContainer.style.display = 'block';
                confirmButton.style.display = 'block';
            }
            
            showStep('0_6');
        }
        
        // è¿”å´ã™ã‚‹ã‚»ãƒ³ã‚µã‚’ç¢ºèª
        function confirmReturn() {
            const select = document.getElementById('userSensorSelect');
            const selection = select.value;
            
            if (!selection) {
                alert('è¿”å´ã™ã‚‹LiDARã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            // é¸æŠã•ã‚ŒãŸã‚»ãƒ³ã‚µã®æƒ…å ±ã‚’å–å¾—
            selectedReturnSensor = JSON.parse(selection);
            const userName = document.getElementById('returnSearchName').value;
            
            // è¿”å´æƒ…å ±ã‚’è¡¨ç¤º
            document.getElementById('returnInfoMaker').textContent = selectedReturnSensor.maker;
            document.getElementById('returnInfoId').textContent = selectedReturnSensor.id;
            document.getElementById('returnInfoModel').textContent = selectedReturnSensor.model;
            document.getElementById('returnInfoUser').textContent = userName;
            
            // è¿”å´ç”»é¢ã‚’è¡¨ç¤º
            isReturning = true;
            showStep(2);
            document.getElementById('statusAvailable').style.display = 'none';
            document.getElementById('statusReturning').style.display = 'block';
        }
        
        // ã‚»ãƒ³ã‚µIDã®ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã‚’æ›´æ–°
        function updateSensorIds() {
            const sensorTypeSelect = document.getElementById('sensorType');
            const sensorIdSelect = document.getElementById('sensorId');
            const selectedType = sensorTypeSelect.value;
            
            // ã¾ãšã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆ
            sensorIdSelect.innerHTML = '';
            
            if (!selectedType) {
                // ä½•ã‚‚é¸æŠã•ã‚Œã¦ã„ãªã„å ´åˆ
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = 'ãƒ¡ãƒ¼ã‚«ãƒ¼ã‚’å…ˆã«é¸æŠã—ã¦ãã ã•ã„';
                sensorIdSelect.appendChild(defaultOption);
                sensorIdSelect.disabled = true;
                return;
            }
            
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚ªãƒ—ã‚·ãƒ§ãƒ³
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'é¸æŠã—ã¦ãã ã•ã„';
            sensorIdSelect.appendChild(defaultOption);
            
            // é¸æŠã•ã‚ŒãŸã‚»ãƒ³ã‚µã‚¿ã‚¤ãƒ—ã«å¯¾å¿œã™ã‚‹IDã‚’è¿½åŠ ï¼ˆåˆ©ç”¨å¯èƒ½ãªã‚‚ã®ã®ã¿ï¼‰
            const ids = sensorIds[selectedType] || [];
            const availableIds = ids.filter(idInfo => idInfo.status === 'available');
            
            if (availableIds.length === 0) {
                const noOption = document.createElement('option');
                noOption.value = '';
                noOption.textContent = 'åˆ©ç”¨å¯èƒ½ãªLiDARã¯ã‚ã‚Šã¾ã›ã‚“';
                noOption.disabled = true;
                sensorIdSelect.appendChild(noOption);
            } else {
                availableIds.forEach(idInfo => {
                    const option = document.createElement('option');
                    option.value = JSON.stringify({
                        id: idInfo.id,
                        model: idInfo.model
                    });
                    option.textContent = `${idInfo.id} - ${idInfo.model}`;
                    sensorIdSelect.appendChild(option);
                });
            }
            
            // ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’æœ‰åŠ¹åŒ–
            sensorIdSelect.disabled = false;
        }
        
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
        function checkStatus() {
            const sensorTypeSelect = document.getElementById('sensorType');
            const sensorIdSelect = document.getElementById('sensorId');
            const sensorType = sensorTypeSelect.value;
            const sensorIdValue = sensorIdSelect.value;
            
            if (!sensorType || !sensorIdValue) {
                alert('ãƒ¡ãƒ¼ã‚«ãƒ¼ã¨LiDAR IDã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            // é¸æŠã•ã‚ŒãŸã‚»ãƒ³ã‚µã®æƒ…å ±ã‚’JSONã‹ã‚‰å–å¾—
            const sensorInfo = JSON.parse(sensorIdValue);
            
            showStep(2);
            
            // å¸¸ã«åˆ©ç”¨å¯èƒ½çŠ¶æ…‹ã‚’è¡¨ç¤ºï¼ˆåˆ©ç”¨å¯èƒ½ãªã‚»ãƒ³ã‚µã®ã¿ã‚’è¡¨ç¤ºã—ã¦ã„ã‚‹ãŸã‚ï¼‰
            document.getElementById('statusAvailable').style.display = 'block';
            document.getElementById('statusReturning').style.display = 'none';
        }
        
        // ã‚¹ãƒ†ãƒƒãƒ—è¡¨ç¤ºé–¢æ•°
        function showStep(stepNumber) {
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active');
            });
            document.getElementById('step' + stepNumber).classList.add('active');
        }
        
        // åˆ©ç”¨ç™»éŒ²å‡¦ç†
        function registerUsage() {
            const userName = document.getElementById('userName').value;
            const purpose = document.getElementById('purpose').value;
            
            if (!userName || !purpose) {
                alert('ãŠåå‰ã¨ç”¨é€”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            const sensorTypeSelect = document.getElementById('sensorType');
            const sensorIdSelect = document.getElementById('sensorId');
            const sensorType = sensorTypeSelect.value;
            const sensorIdValue = sensorIdSelect.value;
            
            // é¸æŠã•ã‚ŒãŸã‚»ãƒ³ã‚µã®æƒ…å ±ã‚’JSONã‹ã‚‰å–å¾—
            const sensorInfo = JSON.parse(sensorIdValue);
            
            // ãƒ¢ãƒƒã‚¯ã®éåŒæœŸæ“ä½œï¼ˆæœ¬ç•ªã§ã¯å®Ÿéš›ã®APIã‚’å‘¼ã³å‡ºã™ï¼‰
            setTimeout(() => {
                // ã“ã“ã§å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã™ã‚‹ï¼ˆãƒ¢ãƒƒã‚¯ç”¨ï¼‰
                sensorIds[sensorType].forEach(sensor => {
                    if (sensor.id === sensorInfo.id) {
                        sensor.status = 'in-use';
                        sensor.user = userName;
                        sensor.purpose = purpose;
                    }
                });
                
                showStep(3);
                document.getElementById('registrationComplete').style.display = 'block';
                document.getElementById('returnComplete').style.display = 'none';
                
                // ç™»éŒ²æƒ…å ±ã®ã‚µãƒãƒªãƒ¼
                const sensorTypeName = sensorTypes.find(t => t.id == sensorType)?.name || '';
                
                document.getElementById('summaryType').textContent = sensorTypeName;
                document.getElementById('summaryId').textContent = sensorInfo.id;
                document.getElementById('summaryModel').textContent = sensorInfo.model;
                document.getElementById('summaryUser').textContent = userName;
                document.getElementById('summaryPurpose').textContent = purpose;
            }, 500);
        }
        
        // ã‚»ãƒ³ã‚µè¿”å´å‡¦ç†
        function returnSensor() {
            const returnComment = document.getElementById('returnComment').value || 'ãªã—';
            const userName = document.getElementById('returnSearchName').value;
            
            if (!selectedReturnSensor) {
                alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ã‚„ã‚Šç›´ã—ã¦ãã ã•ã„');
                resetForm();
                return;
            }
            
            // ãƒ¢ãƒƒã‚¯ã®éåŒæœŸæ“ä½œï¼ˆæœ¬ç•ªã§ã¯å®Ÿéš›ã®APIã‚’å‘¼ã³å‡ºã™ï¼‰
            setTimeout(() => {
                // ã“ã“ã§å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã™ã‚‹ï¼ˆãƒ¢ãƒƒã‚¯ç”¨ï¼‰
                sensorIds[selectedReturnSensor.makerid].forEach(sensor => {
                    if (sensor.id === selectedReturnSensor.id) {
                        sensor.status = 'available';
                        sensor.user = null;
                        sensor.purpose = null;
                    }
                });
                
                showStep(3);
                document.getElementById('registrationComplete').style.display = 'none';
                document.getElementById('returnComplete').style.display = 'block';
                
                // è¿”å´æƒ…å ±ã®ã‚µãƒãƒªãƒ¼
                document.getElementById('returnSummaryType').textContent = selectedReturnSensor.maker;
                document.getElementById('returnSummaryId').textContent = selectedReturnSensor.id;
                document.getElementById('returnSummaryModel').textContent = selectedReturnSensor.model;
                document.getElementById('returnSummaryUser').textContent = userName;
                document.getElementById('returnSummaryComment').textContent = returnComment;
            }, 500);
        }
        
        // ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒªã‚»ãƒƒãƒˆ
        function resetForm() {
            document.getElementById('sensorType').value = '';
            document.getElementById('sensorId').innerHTML = '<option value="">ãƒ¡ãƒ¼ã‚«ãƒ¼ã‚’å…ˆã«é¸æŠã—ã¦ãã ã•ã„</option>';
            document.getElementById('sensorId').disabled = true;
            document.getElementById('userName').value = '';
            document.getElementById('purpose').value = '';
            
            if (document.getElementById('returnSearchName')) {
                document.getElementById('returnSearchName').value = '';
            }
            if (document.getElementById('returnComment')) {
                document.getElementById('returnComment').value = '';
            }
            
            isReturning = false;
            selectedReturnSensor = null;
            
            showStep(0);
        }
    </script>
</html><!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚»ãƒ³ã‚µç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - LiDARåˆ©ç”¨ç™»éŒ²</title>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 500px;
            margin: 20px auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 20px;
        }
        
        .sensor-icon {
            font-size: 48px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .step {
            display: none;
        }
        
        .step.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px;
        }
        
        button {
            display: block;
            width: 100%;
            padding: 12px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        
        .status-box {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .status-available {
            background-color: #e8f8f5;
            border: 1px solid #82e0aa;
        }
        
        .status-inuse {
            background-color: #fdedec;
            border: 1px solid #f5b7b1;
        }
        
        .status-returning {
            background-color: #eaf2f8;
            border: 1px solid #aed6f1;
        }
        
        .status-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .status-text {
            font-weight: bold;
        }
        
        .available-icon {
            background-color: #82e0aa;
            color: white;
        }
        
        .inuse-icon {
            background-color: #f5b7b1;
            color: white;
        }
        
        .returning-icon {
            background-color: #aed6f1;
            color: white;
        }
        
        .secondary-button {
            background-color: #95a5a6;
            margin-top: 10px;
        }
        
        .secondary-button:hover {
            background-color: #7f8c8d;
        }
        
        .completion-message {
            text-align: center;
            padding: 20px 0;
        }
        
        .completion-icon {
            font-size: 48px;
            color: #27ae60;
            margin-bottom: 10px;
        }
        
        .info-panel {
            background-color: #f8f9fa;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .info-list {
            list-style-type: none;
            padding: 0;
        }
        
        .info-list li {
            padding: 5px 0;
            border-bottom: 1px solid #ecf0f1;
        }
        
        .info-list li:last-child {
            border-bottom: none;
        }
        
        .alert {
            background-color: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
    </style>
</head>
</html>